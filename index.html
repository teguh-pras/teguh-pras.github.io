<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard Inkubator A & B</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f8fa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
      width: 340px;
    }
    .title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
      color: #0077cc;
    }
    .data {
      font-size: 16px;
      margin: 6px 0;
    }
    .relay {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .relay button {
      border: none;
      border-radius: 8px;
      padding: 10px 0;
      font-size: 15px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .on {
      background: #007bff;
    }
    .off {
      background: #b0b0b0;
    }
    .update-time {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin-top: 10px;
      font-style: italic;
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    // ðŸ”¹ KONFIGURASI FIREBASE
    const firebaseConfig = {
      apiKey: "AIzaSyAJTwkiE4kE0v85wN8Xgxa3dXKqV7syREQ",
      databaseURL: "https://penetastukik-default-rtdb.asia-southeast1.firebasedatabase.app/",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ðŸ”¹ Fungsi bantu update nilai
    function updateValue(id, value, suffix = "") {
      const el = document.getElementById(id);
      if (el) el.textContent = value + suffix;
    }

    // ðŸ”¹ Fungsi format waktu lokal WIB
    function formatTimeWIB() {
      const date = new Date();
      const formatter = new Intl.DateTimeFormat("id-ID", {
        timeZone: "Asia/Jakarta",
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });
      return formatter.format(date) + " WIB";
    }

    function updateLastTime(id) {
      const el = document.getElementById(id);
      if (el) el.textContent = formatTimeWIB();
    }

    // ðŸ”¹ Fungsi update tombol relay
    function updateRelay(id, name, state) {
      const btn = document.getElementById(id);
      if (btn) {
        btn.className = state ? "on" : "off";
        btn.textContent = `${name}: ${state ? "ON" : "OFF"}`;
      }
    }

    // ---------------- INKUBATOR A ----------------
    onValue(ref(db, "inkubatorA/suhu"), snap => {
      updateValue("suhuA", snap.val(), " Â°C");
      updateLastTime("lastUpdateA");
    });
    onValue(ref(db, "inkubatorA/kelembapan"), snap => updateValue("kelembapanA", snap.val(), " %"));
    onValue(ref(db, "inkubatorA/relay/lampu"), snap => updateRelay("lampuA", "Lampu", snap.val()));
    onValue(ref(db, "inkubatorA/relay/pompa"), snap => updateRelay("pompaA", "Pompa", snap.val()));
    onValue(ref(db, "inkubatorA/relay/peltier"), snap => updateRelay("peltierA", "Peltier", snap.val()));
    onValue(ref(db, "inkubatorA/relay/fan"), snap => updateRelay("fanA", "Fan", snap.val()));

    // ---------------- INKUBATOR B ----------------
    onValue(ref(db, "inkubatorB/suhu"), snap => {
      updateValue("suhuB", snap.val(), " Â°C");
      updateLastTime("lastUpdateB");
    });
    onValue(ref(db, "inkubatorB/kelembapan"), snap => updateValue("kelembapanB", snap.val(), " %"));
    onValue(ref(db, "inkubatorB/relay/lampu"), snap => updateRelay("lampuB", "Lampu", snap.val()));
    onValue(ref(db, "inkubatorB/relay/pompa"), snap => updateRelay("pompaB", "Pompa", snap.val()));
    onValue(ref(db, "inkubatorB/relay/peltier"), snap => updateRelay("peltierB", "Peltier", snap.val()));
    onValue(ref(db, "inkubatorB/relay/fan"), snap => updateRelay("fanB", "Fan", snap.val()));
  </script>
</head>

<body>
  <h1>Dashboard Inkubator</h1>

  <!-- ðŸ”µ Inkubator A -->
  <div class="card">
    <div class="title">Inkubator A</div>
    <div class="data">Suhu: <span id="suhuA">--</span></div>
    <div class="data">Kelembapan: <span id="kelembapanA">--</span></div>
    <div class="relay">
      <button id="lampuA" class="off">Lampu: OFF</button>
      <button id="pompaA" class="off">Pompa: OFF</button>
      <button id="peltierA" class="off">Peltier: OFF</button>
      <button id="fanA" class="off">Fan: OFF</button>
    </div>
    <div class="update-time">Terakhir diperbarui: <span id="lastUpdateA">--</span></div>
  </div>

  <!-- ðŸ”µ Inkubator B -->
  <div class="card">
    <div class="title">Inkubator B</div>
    <div class="data">Suhu: <span id="suhuB">--</span></div>
    <div class="data">Kelembapan: <span id="kelembapanB">--</span></div>
    <div class="relay">
      <button id="lampuB" class="off">Lampu: OFF</button>
      <button id="pompaB" class="off">Pompa: OFF</button>
      <button id="peltierB" class="off">Peltier: OFF</button>
      <button id="fanB" class="off">Fan: OFF</button>
    </div>
    <div class="update-time">Terakhir diperbarui: <span id="lastUpdateB">--</span></div>
  </div>
</body>
</html>


